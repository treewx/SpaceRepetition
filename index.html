<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spaced Repetition Flash Cards</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app">
        <header>
            <h1>🧠 Flash Cards</h1>
            <nav>
                <button id="manage-tab" class="tab-btn active">Manage Cards</button>
                <button id="review-tab" class="tab-btn">Review</button>
                <button id="dictionary-tab" class="tab-btn">Dictionary</button>
                <button id="memory-palace-tab" class="tab-btn">Memory Palace</button>
                <button id="autogenerate-tab" class="tab-btn">Auto Generate</button>
            </nav>
        </header>

        <main>
            <!-- Card Management Section -->
            <section id="manage-section" class="section active">
                <div class="controls">
                    <div class="controls-left">
                        <button id="add-card-btn" class="btn primary">+ Add Card</button>
                        <button id="manage-categories-btn" class="btn secondary">Manage Categories</button>
                    </div>
                    <div class="controls-right">
                        <select id="category-filter" class="category-select">
                            <option value="all">All Categories</option>
                        </select>
                        <span id="card-count">0 cards</span>
                    </div>
                </div>
                <div id="card-list" class="card-list"></div>
            </section>

            <!-- Review Section -->
            <section id="review-section" class="section">
                <div class="review-controls">
                    <select id="review-category-filter" class="category-select">
                        <option value="all">Review All Categories</option>
                    </select>
                </div>
                <div id="review-container">
                    <div id="no-cards-message" class="message">
                        No cards ready for review. Add some cards first!
                    </div>
                    <div id="card-review" class="card-review hidden">
                        <div class="card-progress">
                            <span id="progress-text">Card 1 of 5</span>
                        </div>
                        <div class="flashcard">
                            <div id="card-content" class="card-content">
                                <div id="card-text"></div>
                                <div id="card-image" class="card-image hidden"></div>
                            </div>
                            <button id="flip-btn" class="btn">Show Answer</button>
                        </div>
                        <div id="review-actions" class="review-actions hidden">
                            <button id="hard-btn" class="btn difficulty hard">Hard</button>
                            <button id="good-btn" class="btn difficulty good">Good</button>
                            <button id="easy-btn" class="btn difficulty easy">Easy</button>
                        </div>
                        <div class="ai-image-controls">
                            <button id="add-image-btn" class="btn secondary">+ Add AI Image</button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Dictionary Section -->
            <section id="dictionary-section" class="section">
                <div class="dictionary-header">
                    <h2>🎯 Character Mnemonic Dictionary</h2>
                    <p>Create memorable images and stories for each Chinese character to build your character memory system.</p>
                </div>
                <div class="dictionary-controls">
                    <div class="search-controls">
                        <button id="add-character-btn" class="btn primary">+ Add Character</button>
                        <input type="text" id="character-search" placeholder="Search characters..." class="search-input">
                        <select id="frequency-filter" class="category-select">
                            <option value="all">All Characters</option>
                            <option value="top100">Top 100 Most Frequent</option>
                            <option value="top500">Top 500 Most Frequent</option>
                            <option value="top1000">Top 1000 Most Frequent</option>
                        </select>
                        <select id="completion-filter" class="category-select">
                            <option value="all">All Characters</option>
                            <option value="complete">With Mnemonics</option>
                            <option value="incomplete">Without Mnemonics</option>
                        </select>
                    </div>
                    <div class="stats">
                        <span id="character-stats">0 / 0 characters complete</span>
                    </div>
                </div>
                <div id="character-grid" class="character-grid"></div>
            </section>

            <!-- Memory Palace Section -->
            <section id="memory-palace-section" class="section">
                <div class="memory-palace-header">
                    <h2>🏛️ Memory Palace</h2>
                    <p>Upload a room image and place your dictionary characters in specific locations to enhance spatial memory.</p>
                </div>
                
                <div class="memory-palace-controls">
                    <div class="palace-controls-left">
                        <input type="file" id="palace-image-input" accept="image/*" style="display: none;">
                        <button id="upload-palace-btn" class="btn primary">📷 Upload Room Image</button>
                        <button id="clear-palace-btn" class="btn secondary hidden">🗑️ Clear Palace</button>
                        <button id="download-palace-btn" class="btn primary hidden">💾 Download Image</button>
                    </div>
                    <div class="palace-controls-right">
                        <span id="placed-items-count">0 characters placed</span>
                    </div>
                </div>

                <div id="memory-palace-container" class="memory-palace-container">
                    <div id="palace-empty-state" class="palace-empty-state">
                        <div class="empty-state-content">
                            <h3>📍 Create Your Memory Palace</h3>
                            <p>Upload an image of a room, house, or any familiar place</p>
                            <p>Then drag character images from your dictionary below to place them in the room</p>
                            <button class="btn primary" onclick="document.getElementById('palace-image-input').click()">
                                📷 Upload Room Image
                            </button>
                        </div>
                    </div>
                    
                    <div id="palace-workspace" class="palace-workspace hidden">
                        <div id="palace-background" class="palace-background">
                            <img id="palace-background-img" src="" alt="Memory Palace Background">
                            <div id="palace-items-layer" class="palace-items-layer"></div>
                        </div>
                    </div>
                </div>

                <div id="character-palette" class="character-palette">
                    <h3>📚 Character Palette</h3>
                    <p>Drag characters from below onto your memory palace:</p>
                    <div id="palette-characters" class="palette-characters"></div>
                </div>
            </section>

            <!-- Auto Generate Section -->
            <section id="autogenerate-section" class="section">
                <div class="autogenerate-header">
                    <h2>🤖 Auto Generate Cards</h2>
                    <p>Enter English phrases to automatically translate to Chinese with pinyin and syllable images.</p>
                </div>
                
                <div class="autogenerate-input">
                    <div class="form-group">
                        <label for="english-phrase">English Phrase:</label>
                        <textarea id="english-phrase" rows="3" placeholder="Enter English phrase or sentence..."></textarea>
                    </div>
                    <button id="translate-btn" class="btn primary">🔄 Translate & Generate</button>
                </div>

                <div id="translation-result" class="translation-result hidden">
                    <div class="translation-row">
                        <div class="translation-section">
                            <h3>🇬🇧 English</h3>
                            <div id="english-text" class="text-display"></div>
                        </div>
                        <div class="translation-section">
                            <h3>🇨🇳 Chinese Characters</h3>
                            <div id="chinese-text" class="text-display chinese-characters"></div>
                        </div>
                        <div class="translation-section">
                            <h3>📝 Chinglish (Word-by-Word)</h3>
                            <div id="chinglish-text" class="text-display chinglish-text"></div>
                        </div>
                        <div class="translation-section">
                            <h3>🗣️ Pinyin</h3>
                            <div id="pinyin-text" class="text-display pinyin-text"></div>
                        </div>
                    </div>

                    <div class="syllable-images-section">
                        <h3>🖼️ Syllable Images</h3>
                        <div id="syllable-images-grid" class="syllable-images-grid"></div>
                    </div>

                    <div class="generate-actions">
                        <button id="create-card-from-translation" class="btn primary">✨ Create Flash Card</button>
                        <button id="save-translation" class="btn secondary">💾 Save Translation</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Add/Edit Card Modal -->
    <div id="card-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">Add New Card</h2>
                <button id="close-modal" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="front-text">Front:</label>
                    <textarea id="front-text" placeholder="Enter the question or prompt"></textarea>
                </div>
                <div class="form-group">
                    <label for="back-text">Back:</label>
                    <textarea id="back-text" placeholder="Enter the answer"></textarea>
                </div>
                <div class="form-group">
                    <label for="card-category">Category:</label>
                    <select id="card-category" class="category-select">
                        <option value="general">General</option>
                    </select>
                </div>

                <!-- AI Image Section -->
                <div class="card-images-section">
                    <h3>Card Images</h3>
                    <div class="card-images-container">
                        <div class="card-image-side">
                            <h4>Front Image</h4>
                            <div id="card-front-image-preview" class="card-image-preview">
                                <div class="no-image-placeholder">No image</div>
                            </div>
                            <div class="image-controls">
                                <button type="button" id="add-front-image-btn" class="btn secondary small">+ Add AI Image</button>
                                <button type="button" id="upload-front-image-btn" class="btn secondary small">+ Upload Image</button>
                                <button type="button" id="remove-front-image-btn" class="btn secondary small hidden">Remove</button>
                            </div>
                        </div>
                        <div class="card-image-side">
                            <h4>Back Image</h4>
                            <div id="card-back-image-preview" class="card-image-preview">
                                <div class="no-image-placeholder">No image</div>
                            </div>
                            <div class="image-controls">
                                <button type="button" id="add-back-image-btn" class="btn secondary small">+ Add AI Image</button>
                                <button type="button" id="upload-back-image-btn" class="btn secondary small">+ Upload Image</button>
                                <button type="button" id="remove-back-image-btn" class="btn secondary small hidden">Remove</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Hidden file inputs for image uploads -->
                <input type="file" id="front-image-upload" accept="image/*" style="display: none;">
                <input type="file" id="back-image-upload" accept="image/*" style="display: none;">

                <!-- Image Generation Form (initially hidden) -->
                <div id="card-image-generation" class="image-generation-section hidden">
                    <h4 id="generating-for-side">Generating image for: Front</h4>
                    <div class="form-group">
                        <label for="card-image-prompt">Image Description:</label>
                        <textarea id="card-image-prompt" placeholder="Describe the image you want to generate..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="card-gemini-api-key">Google Gemini API Key:</label>
                        <input type="password" id="card-gemini-api-key" placeholder="Enter your Gemini API key" />
                    </div>
                    <div class="image-actions">
                        <button type="button" id="generate-card-image-btn" class="btn primary">Generate Image</button>
                        <button type="button" id="save-card-image-btn" class="btn primary hidden">Save Image</button>
                        <button type="button" id="cancel-card-image-btn" class="btn secondary">Cancel</button>
                    </div>
                    <div id="card-image-generation-preview" class="image-preview hidden"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancel-btn" class="btn secondary">Cancel</button>
                <button id="save-card-btn" class="btn primary">Save Card</button>
            </div>
        </div>
    </div>

    <!-- AI Image Generation Modal -->
    <div id="image-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Generate AI Image with Gemini</h2>
                <button id="close-image-modal" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="gemini-api-key">Google Gemini API Key:</label>
                    <input type="password" id="gemini-api-key" placeholder="Enter your Gemini API key" />
                    <small>Get your API key from <a href="https://ai.google.dev/" target="_blank">Google AI Studio</a></small>
                </div>
                <div class="form-group">
                    <label for="image-prompt">Describe the image you want:</label>
                    <textarea id="image-prompt" placeholder="e.g., A detailed illustration of a banana wearing a tiny crown, sitting on a throne made of books, cartoon style"></textarea>
                </div>
                <div class="form-group">
                    <label>Add to:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="image-side" value="front" checked> Front of card</label>
                        <label><input type="radio" name="image-side" value="back"> Back of card</label>
                    </div>
                </div>
                <div id="image-preview" class="image-preview hidden"></div>
            </div>
            <div class="modal-footer">
                <button id="cancel-image-btn" class="btn secondary">Cancel</button>
                <button id="generate-image-btn" class="btn primary">Generate Image</button>
                <button id="save-image-btn" class="btn primary hidden">Save Image</button>
            </div>
        </div>
    </div>

    <!-- Category Management Modal -->
    <div id="category-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="category-modal-title">Manage Categories</h2>
                <button id="close-category-modal" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="category-form">
                    <div class="form-group">
                        <label for="category-name">Category Name:</label>
                        <input type="text" id="category-name" placeholder="Enter category name">
                    </div>
                    <div class="form-group">
                        <label for="category-color">Color:</label>
                        <input type="color" id="category-color" value="#4CAF50">
                    </div>
                    <button id="save-category-btn" class="btn primary">Add Category</button>
                </div>
                <div class="category-list">
                    <h3>Existing Categories</h3>
                    <div id="existing-categories"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="close-category-modal-btn" class="btn secondary">Close</button>
            </div>
        </div>
    </div>

    <!-- Syllable Detail Modal -->
    <div id="character-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="character-modal-title">Create Mnemonic for: 我</h2>
                <button id="close-character-modal" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <div class="character-info">
                    <div class="character-display">
                        <div class="form-group" id="english-word-group">
                            <label for="english-word-input">English Word:</label>
                            <div class="english-input-row">
                                <input type="text" id="english-word-input" placeholder="Enter English word (e.g., Apple)" class="english-input">
                                <button id="translate-word-btn" class="btn primary">🔄 Generate</button>
                            </div>
                        </div>
                        <div class="form-group" id="character-input-group">
                            <label for="new-character-input">Chinese Character:</label>
                            <input type="text" id="new-character-input" placeholder="Enter Chinese character (e.g., 我)" maxlength="3" class="character-input">
                        </div>
                        <div class="form-group" id="pinyin-input-group">
                            <label for="new-pinyin-input">Pinyin:</label>
                            <input type="text" id="new-pinyin-input" placeholder="Enter pinyin (e.g., wǒ)" class="pinyin-input">
                        </div>
                        <div class="form-group" id="meaning-input-group">
                            <label for="new-meaning-input">Meaning:</label>
                            <input type="text" id="new-meaning-input" placeholder="Enter English meaning (e.g., I, me)" class="meaning-input">
                        </div>
                        <div class="character-text" id="current-character">我</div>
                        <div class="character-pinyin" id="current-pinyin">wǒ</div>
                        <div class="character-meaning" id="current-meaning">I, me</div>
                    </div>
                    <div class="character-examples" id="character-examples">
                        <h4>Example sentences using this character:</h4>
                        <div class="example-words"></div>
                    </div>
                </div>
                
                <div class="mnemonic-section">
                    <div class="current-image" id="current-character-image">
                        <div class="no-image-placeholder">No mnemonic image yet</div>
                    </div>
                    
                    <div class="mnemonic-form">
                        <div class="form-group">
                            <label for="character-mnemonic-story">Mnemonic Story:</label>
                            <textarea id="character-mnemonic-story" placeholder="Create a memorable story for this character (e.g., 'The character 我 looks like a person with a weapon defending themselves')"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="character-image-prompt">Image Prompt:</label>
                            <textarea id="character-image-prompt" placeholder="Describe the image you want to generate for this character..."></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="character-gemini-api-key">Google Gemini API Key:</label>
                            <input type="password" id="character-gemini-api-key" placeholder="Enter your Gemini API key" />
                        </div>
                        
                        <div class="image-actions">
                            <button id="generate-character-image-btn" class="btn primary">Generate Mnemonic Image</button>
                            <button id="save-character-btn" class="btn primary hidden">Save Mnemonic</button>
                            <button id="remove-character-image-btn" class="btn secondary hidden">Remove Image</button>
                        </div>
                        
                        <div id="character-image-preview" class="image-preview hidden"></div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="close-character-modal-btn" class="btn secondary">Close</button>
            </div>
        </div>
    </div>

    <script src="api.js"></script>
    <script src="app.js"></script>
</body>
</html>